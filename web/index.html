<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistema de Identificación de Válvulas - Demo</title>
  <!-- Tailwind CDN for responsive utilities -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <header class="app-header">
    <h1>Sistema de Identificación de Válvulas Neumáticas</h1>
  </header>

  <!-- Navbar -->
  <nav class="app-nav" aria-label="Barra de navegación">
    <button id="btnNavToggle" class="nav-toggle" type="button" aria-expanded="false" aria-controls="navItems">Menú</button>
    <div id="navItems" class="nav-items" role="menubar">
      <button id="btnTabImages" class="nav-btn" type="button" role="menuitem">Imágenes</button>
      <button id="btnTabQR" class="nav-btn" type="button" role="menuitem">Lector QR</button>
      <button id="btnTabAIRecognize" class="nav-btn" type="button" role="menuitem">Reconocer con AI</button>
      <button id="btnTabAITrain" class="nav-btn" type="button" role="menuitem">Entrenar AI</button>
      <button id="btnTabUpload" class="nav-btn" type="button" role="menuitem">Cargar Excel</button>
    </div>
  </nav>

  <main class="app-main">
    <div class="layout">
      <aside id="sidebar" class="sidebar" aria-label="Panel lateral de información">
        <div class="sidebar-header">
          <h2 class="camera-title" id="sidebarTitle">Detalle</h2>
        </div>
        <div id="sidebarBody" class="sidebar-body" aria-live="polite"></div>
      </aside>

      <div class="content">
        <section id="status" class="status" aria-live="polite"></section>

        <!-- Imágenes / Grid -->
        <section id="imagesPanel" aria-label="Menú de válvulas">
          <div class="search-bar" role="search">
            <label for="searchBox" class="sr-only">Buscar referencia</label>
            <input id="searchBox" type="search" autocomplete="off" placeholder="Buscar por referencia o nombre…" aria-label="Buscar por referencia o nombre">
            <button id="btnClearSearch" type="button" class="nav-btn" aria-label="Limpiar búsqueda">Limpiar</button>
            <span id="searchCount" class="subtitle" aria-live="polite"></span>
            <span id="bankFilters" class="bank-filters" style="margin-left:18px;vertical-align:middle;">
              <button type="button" class="bank-chip bank-A" aria-pressed="false" title="Filtrar por banco A">A</button>
              <button type="button" class="bank-chip bank-B" aria-pressed="false" title="Filtrar por banco B">B</button>
              <button type="button" class="bank-chip bank-C" aria-pressed="false" title="Filtrar por banco C">C</button>
              <button type="button" class="bank-chip bank-D" aria-pressed="false" title="Filtrar por banco D">D</button>
            </span>
          </div>
          <div id="grid" class="grid" role="list"></div>
        </section>

        <!-- Cámara / Vista previa (guía QR/Barcode) -->
        <section id="cameraPanel" class="camera-panel" aria-label="Vista previa de cámara" hidden>
          <div class="camera-header">
            <h2 class="camera-title">Cámara</h2>
          </div>
          <div class="camera-body">
            <div class="camera-wrap">
              <div id="qr-reader"></div>
              <!-- Overlay guía para QR/Barcode -->
              <div class="overlay-guide" aria-hidden="true">
                <div class="frame center-box"></div>
                <div class="guide-text" id="qrGuideText">Coloca el QR o código de barras dentro del marco</div>
              </div>
            </div>
          </div>
          <div class="camera-footer">
            <button id="btnAbrirCam" class="nav-btn" type="button">Abrir cámara</button>
            <button id="btnCerrarCam" class="nav-btn" type="button" hidden>Cerrar cámara</button>
            <span class="subtitle" style="margin-left:8px">Vista previa sin escaneo</span>
          </div>
        </section>

        <!-- Reconocer con AI / Reconocimiento por imagen (guía de encuadre) -->
        <section id="aiPanel" class="ai-panel" aria-label="Reconocer con IA" hidden>
          <div class="camera-header">
            <h2 class="camera-title">Reconocer con IA - Válvulas</h2>
          </div>
          <div class="camera-body">
            <div class="camera-wrap">
              <video id="aiVideo" autoplay playsinline muted></video>
              <div class="overlay-guide" aria-hidden="true">
                <div class="frame center-box"></div>
                <div class="guide-text" id="aiGuideText">Alinea la válvula dentro del marco. Acércate o aléjate hasta que se
                  vea nítida.</div>
              </div>
            </div>
            <canvas id="aiCanvas" hidden></canvas>
          </div>
          <div class="camera-footer">
            <button id="btnAIStart" class="nav-btn" type="button">Iniciar cámara</button>
            <button id="btnAIStop" class="nav-btn" type="button" hidden>Detener cámara</button>
            <button id="btnAICapture" class="nav-btn" type="button" disabled>Capturar y reconocer</button>
          </div>
          <div class="ai-result" id="aiResult" aria-live="polite"></div>
        </section>

        <!-- Entrenar AI / Búsqueda y captura de múltiples fotos -->
        <section id="aiTrainPanel" class="ai-panel" aria-label="Entrenar IA" hidden>
          <div class="camera-header">
            <h2 class="camera-title">Entrenar IA</h2>
          </div>
          <div class="camera-body">
            <div class="search-bar" role="search">
              <label for="aiTrainSearch" class="sr-only">Buscar por nombre o número de serie</label>
              <input id="aiTrainSearch" type="search" autocomplete="off" placeholder="Buscar por nombre o número de serie…" aria-label="Buscar por nombre o número de serie">
              <button id="btnAiTrainClear" type="button" class="nav-btn" aria-label="Limpiar búsqueda">Limpiar</button>
              <span id="aiTrainSearchCount" class="subtitle" aria-live="polite"></span>
            </div>
            <div id="aiTrainResults" class="grid" role="list" aria-label="Resultados de búsqueda"></div>
            <div class="camera-wrap" style="margin-top:12px">
              <video id="aiTrainVideo" autoplay playsinline muted></video>
              <canvas id="aiTrainCanvas" hidden></canvas>
            </div>
            <div id="aiTrainSelectedInfo" class="subtitle" style="margin-top:8px">Entrenando referencia: —</div>
          </div>
          <div class="camera-footer">
            <button id="btnAiTrainStart" class="nav-btn" type="button">Iniciar cámara</button>
            <button id="btnAiTrainStop" class="nav-btn" type="button" hidden>Detener cámara</button>
            <button id="btnAiTrainCapture" class="nav-btn" type="button" disabled>Capturar (30s)</button>
            <span id="aiTrainTimer" class="subtitle" style="margin-left:8px"></span>
          </div>
          <div class="ai-result" id="aiTrainLivePrediction" aria-live="polite"></div>
        </section>

        <!-- Carga de Excel -->
        <section id="uploadPanel" class="camera-panel" aria-label="Carga de Excel" hidden>
          <div class="camera-header">
            <h2 class="camera-title">Cargar Excel de Válvulas</h2>
          </div>
          <div class="camera-body">
            <p class="subtitle">Formato requerido: columnas Valvula, Cantidad, Ubicación, # de serie, Ficha tecnica, Simbolo</p>
            <input id="excelFile" type="file" accept=".xlsx" />
            <button id="btnUploadExcel" class="nav-btn" type="button" style="margin-top:10px">Subir y actualizar</button>
            <div id="uploadResult" class="subtitle" style="margin-top:8px"></div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Modal / Panel de detalle para imágenes -->
  <div id="overlay" class="overlay" hidden></div>
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title"
    aria-describedby="modal-desc" hidden>
    <button id="closeBtn" class="close-btn" type="button" aria-label="Cerrar panel">Cerrar</button>
    <h2 id="modal-title"></h2>
    <div id="modal-desc" class="modal-body"></div>
  </div>

  <script src="js/app.js?v=3" defer></script>
  <!-- html5-qrcode offline -->
  <script src="vendor/html5-qrcode/html5-qrcode.min.js" defer></script>
  <script src="js/camera.js" defer></script>
</body>

</html>